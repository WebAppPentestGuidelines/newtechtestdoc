# IDaaSの活用に起因する脆弱性の悪用

その他のマネージドサービスを利用して作成したWebアプリケーションにおいて、設定や実装面において考慮が足りないと脆弱性が作りこまれてしまう事例について紹介。
パッとCognitoしかでてこなかったが、他にもあれば追加したい。

## 概要
## 意図しないサインアップ経路の存在
###  概要
- 社内向けや管理者画面などのサインアップを許容していないサービスを対象
- 意図しない形で第三者からサインアップされる
- 第三者により作成されたアカウントは場合によってはサービスへのアクセスや情報の閲覧ができる可能性がある

### 原因と影響
- 原因: 利用するIDaaSの設定において、ユーザーが自らアカウントを作成できるような設定がなされている
- 影響: 限られた利用者以外に見られては困る情報が閲覧できてしまう。

### 事例紹介

- 公開されている事例がない….

### 対策

- 自己サインアップを許可しない
- 管理者に管理者権限(admin)を割り当てて、その権限でアカウントを作成する
	- Cognitoの場合、User PoolのグループとIdentity Poolを用いて管理者が新規登録ができるようにする
	- Auth0の場合、管理者RoleのユーザーにAPIのアクセス権限を与える

### 学習方法/参考文献

 - 自社blogを出す

## 権限に関するカスタム属性の変更
### 概要
- ユーザーに変更可能な属性値を権限情報に利用する
- これによりユーザーが属性の値を変更することにより

### 原因と影響
- 原因
	- 権限情報をユーザーが操作可能にしている
	- 権限情報を属性に持たせている
- 影響
	- サービス内での権限昇格の可能性
### 事例紹介
### 対策
- [Must] 一般ユーザーに権限情報を含む属性の変更を許可しない
- アプリクライアント等でアクセス制御をしている場合
	- 管理者用のクライアント(Cognitoの場合クライアントID)を一般ユーザーが取得できないようにする
	- IP制限以外ない….?
- よりセキュアにするための代替案
	- Cognitoの場合、Userの属性で権限情報を管理するのではなく、User PoolのグループとCognito Identity Poolを用いて権限の管理をすることをお勧めする
		- GroupにIAM Roleを付与することでCognitoのAPIの制御も可能

### 学習方法/参考文献

## デフォルトエラーによるユーザーの存在判定
### 概要
- デフォルトのエラーメッセージを有効化していることにより、利用しているユーザーの情報が閲覧できてしまう可能性がある

### 原因と影響
- デフォルトエラーが詳しく返してしまうのが原因
- ユーザーの存在が暴露される

### 事例紹介

### 対策
- 統一されたカスタムメッセージに変更
- 対策が不可能なサービスも存在する(Firebase AuthのID/Pass認証)

### 学習方法/参考文献

## 過剰な権限の付与
### 概要
- クラウドサービスへの権限を付与するサービスにおける過剰な権限の付与

### 原因と影響

### 事例紹介

### 対策
- 最小権限の原則の遵守
	- 必要以上の操作権限を付与しない
	- 必要なリソースへのアクセスを許可する

### 学習方法/参考文献

## EDoS(Economic Denial of Sustainability)
### 概要
- 課金の要素が増えることによるEDoSが想定される
	- Cognitoの場合、Userの数で課金される
		- 検証していなくても課金tな衣装になる

### 原因と影響


### 事例紹介

#### 対策
- 同一IPからのリクエストに対する検知

### 学習方法/参考文献


