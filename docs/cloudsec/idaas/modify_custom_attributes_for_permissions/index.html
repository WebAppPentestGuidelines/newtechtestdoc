<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="アプリケーションの権限に関するカスタム属性の変更 # 概要 # IDaaSの機能を誤って利用することにより、ユーザーに紐づくカスタム属性などの変更が可能になり、アプリケーションにおける権限昇格や意図しないアクセスを引き起こす可能性が存在します。
原因 # 権限情報に関するカスタム属性を変更する機能のアクセス制御が適切に行われていないことから、第三者が属性を変更し権限を書き換える可能性が存在します。本稿ではAmazon Cognitoの誤った利用を例に原因について解説します。
誤った利用の例 1. 権限に関する属性が変更可能
ユーザーに対してアプリケーションの権限に関する属性の変更権限を与えることにより、属性を任意の値に変更される恐れがあります。
$ ACCESS_TOKEN=&#34;eJy...&#34; # JWT形式のアクセストークン $ aws cognito-idp update-user-attributes \ --user-attributes Name=&#34;custom:role&#34;,Value=&#34;admin&#34; \ # アプリケーションの権限に関わるカスタム属性の変更 --access-token $ACCESS_TOKEN 誤った利用の例 2. 公開されたクライアントIDによるアクセス制御
一部IDaaSでは、自らの情報へアクセスを行う際にクライアントIDのような特定の識別子を用いてアクセスを行います。このクライアントIDはユーザの属性に関する変更や閲覧に関する操作を司っており、OIDCにおけるScopeのような動作をします。
このクライアントIDを用いてユーザの属性変更に関するアクセス制御をしており、かつ取得に制限のかけられていないJavaSctriptファイルやapkファイルなどにこの管理者用のクライアントIDが含まれている場合、攻撃者はこのクライアントIDを用いてTokenを発行し、自らの権限に関わる属性を変更しアプリケーション内の権限を昇格させることが可能です。
影響 # 本来であれば閲覧を想定していない第三者が、該当の画面やエンドポイントへアクセスできる可能性があります。
対策 # 根本的対策 # 根本的対策として、一般ユーザーから権限に関わるカスタム属性の値を変更させないようにしてください。権限に関わるカスタム属性の操作を必要とする場合はRBAC等を用いて管理者権限のユーザーのみが変更できるようにしてください。
また、カスタム属性を利用しないで権限を管理する機能がある場合、その機能を用いることも検討してください。
一時的対策 # 一時的対策として、IDaaSへのIP制限等を行い、管理者利用するIDaaSへの一般ユーザーのアクセスをNWレベルで制限してください。
また、本対策を恒久的な対策とせず、根本的な対策を実施してください。
具体: Amazon Cognito User Pool # Amazon Cognito User Poolにおいては、ユーザーの属性で権限情報を管理可能ですが、Cognito User Poolの管理者APIに対してRBACを実装する場合、このユーザグループを用いて管理することも検討してください。
学習方法/参考文献 # Amazon Web Service - Amazon Cognito - ユーザープール属性 Amazon Web Service - Amazon Cognito - ユーザーグループ Flatt Security inc."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="アプリケーションの権限に関するカスタム属性の変更 - IDaaS"><meta property="og:description" content="アプリケーションの権限に関するカスタム属性の変更 # 概要 # IDaaSの機能を誤って利用することにより、ユーザーに紐づくカスタム属性などの変更が可能になり、アプリケーションにおける権限昇格や意図しないアクセスを引き起こす可能性が存在します。
原因 # 権限情報に関するカスタム属性を変更する機能のアクセス制御が適切に行われていないことから、第三者が属性を変更し権限を書き換える可能性が存在します。本稿ではAmazon Cognitoの誤った利用を例に原因について解説します。
誤った利用の例 1. 権限に関する属性が変更可能
ユーザーに対してアプリケーションの権限に関する属性の変更権限を与えることにより、属性を任意の値に変更される恐れがあります。
$ ACCESS_TOKEN=&#34;eJy...&#34; # JWT形式のアクセストークン $ aws cognito-idp update-user-attributes \ --user-attributes Name=&#34;custom:role&#34;,Value=&#34;admin&#34; \ # アプリケーションの権限に関わるカスタム属性の変更 --access-token $ACCESS_TOKEN 誤った利用の例 2. 公開されたクライアントIDによるアクセス制御
一部IDaaSでは、自らの情報へアクセスを行う際にクライアントIDのような特定の識別子を用いてアクセスを行います。このクライアントIDはユーザの属性に関する変更や閲覧に関する操作を司っており、OIDCにおけるScopeのような動作をします。
このクライアントIDを用いてユーザの属性変更に関するアクセス制御をしており、かつ取得に制限のかけられていないJavaSctriptファイルやapkファイルなどにこの管理者用のクライアントIDが含まれている場合、攻撃者はこのクライアントIDを用いてTokenを発行し、自らの権限に関わる属性を変更しアプリケーション内の権限を昇格させることが可能です。
影響 # 本来であれば閲覧を想定していない第三者が、該当の画面やエンドポイントへアクセスできる可能性があります。
対策 # 根本的対策 # 根本的対策として、一般ユーザーから権限に関わるカスタム属性の値を変更させないようにしてください。権限に関わるカスタム属性の操作を必要とする場合はRBAC等を用いて管理者権限のユーザーのみが変更できるようにしてください。
また、カスタム属性を利用しないで権限を管理する機能がある場合、その機能を用いることも検討してください。
一時的対策 # 一時的対策として、IDaaSへのIP制限等を行い、管理者利用するIDaaSへの一般ユーザーのアクセスをNWレベルで制限してください。
また、本対策を恒久的な対策とせず、根本的な対策を実施してください。
具体: Amazon Cognito User Pool # Amazon Cognito User Poolにおいては、ユーザーの属性で権限情報を管理可能ですが、Cognito User Poolの管理者APIに対してRBACを実装する場合、このユーザグループを用いて管理することも検討してください。
学習方法/参考文献 # Amazon Web Service - Amazon Cognito - ユーザープール属性 Amazon Web Service - Amazon Cognito - ユーザーグループ Flatt Security inc."><meta property="og:type" content="article"><meta property="og:url" content="https://webapppentestguidelines.github.io/newtechtestdoc/docs/cloudsec/idaas/modify_custom_attributes_for_permissions/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-03-24T17:07:37+09:00"><title>アプリケーションの権限に関するカスタム属性の変更 - IDaaS | WebApp Testing</title><link rel=manifest href=/newtechtestdoc/manifest.json><link rel=icon href=/newtechtestdoc/favicon.png type=image/x-icon><link rel=stylesheet href=/newtechtestdoc/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/newtechtestdoc/flexsearch.min.js></script>
<script defer src=/newtechtestdoc/ja.search.min.b98c344b6de4f608bc6fd812551cc61370279d34ecd10f070a20509ef8ca8e18.js integrity="sha256-uYw0S23k9gi8b9gSVRzGE3AnnTTs0Q8HCiBQnvjKjhg=" crossorigin=anonymous></script>
<script defer src=/newtechtestdoc/sw.min.a87e9a69c1c9637cd6edeaed247d3a7735fae81f6bc6668f69a2cc0a283426ec.js integrity="sha256-qH6aacHJY3zW7ertJH06dzX66B9rxmaPaaLMCig0Juw=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/newtechtestdoc/><span>WebApp Testing</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=検索 aria-label=検索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/newtechtestdoc/docs/nosql_injection/>NoSQL Injection</a><ul></ul></li><li><a href=/newtechtestdoc/docs/oauth/>OAuth/OpenID Connect</a><ul></ul></li><li><a href=/newtechtestdoc/docs/prototype_pollution/>Prototype Pollution</a><ul></ul></li><li><a href=/newtechtestdoc/docs/toctou/>TOCTOU/レースコンディション</a><ul></ul></li><li><a href=/newtechtestdoc/docs/cloudsec/>クラウドサービスにおけるWebサービスにまつわる脆弱性</a><ul><li><a href=/newtechtestdoc/docs/cloudsec/idaas/>IDaaSの活用に起因する脆弱性とその悪用</a><ul><li><a href=/newtechtestdoc/docs/cloudsec/idaas/edos/>EDoS(Economic Denial of Sustainability) - IDaaS</a></li><li><a href=/newtechtestdoc/docs/cloudsec/idaas/modify_custom_attributes_for_permissions/ class=active>アプリケーションの権限に関するカスタム属性の変更 - IDaaS</a></li><li><a href=/newtechtestdoc/docs/cloudsec/idaas/default_error/>デフォルトエラーに起因するユーザーの開示 - IDaaS</a></li><li><a href=/newtechtestdoc/docs/cloudsec/idaas/presence_of_unintended_signup_paths/>意図しないサインアップ経路の存在 - IDaaS</a></li></ul></li><li><a href=/newtechtestdoc/docs/cloudsec/faas/>FaaSにおける設定不備と脆弱性の悪用</a></li><li><a href=/newtechtestdoc/docs/cloudsec/cloud_credential/>Webアプリケーションの脆弱性を利用した認証情報の窃取</a></li><li><a href=/newtechtestdoc/docs/cloudsec/storage_service/>クラウドストレージサービスにおける設定不備</a></li></ul></li><li><a href=/newtechtestdoc/docs/web_cache_poisoning/>Web Cache Poisoning</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/newtechtestdoc/svg/menu.svg class=book-icon alt=Menu></label>
<strong>アプリケーションの権限に関するカスタム属性の変更 - IDaaS</strong>
<label for=toc-control><img src=/newtechtestdoc/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#概要>概要</a></li><li><a href=#原因>原因</a></li><li><a href=#影響>影響</a></li><li><a href=#対策>対策</a><ul><li><a href=#根本的対策>根本的対策</a></li><li><a href=#一時的対策>一時的対策</a></li><li><a href=#具体-amazon-cognito-user-pool>具体: Amazon Cognito User Pool</a></li></ul></li><li><a href=#学習方法参考文献>学習方法/参考文献</a></li></ul></nav></aside></header><article class=markdown><h1 id=アプリケーションの権限に関するカスタム属性の変更>アプリケーションの権限に関するカスタム属性の変更
<a class=anchor href=#%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e6%a8%a9%e9%99%90%e3%81%ab%e9%96%a2%e3%81%99%e3%82%8b%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%a0%e5%b1%9e%e6%80%a7%e3%81%ae%e5%a4%89%e6%9b%b4>#</a></h1><h2 id=概要>概要
<a class=anchor href=#%e6%a6%82%e8%a6%81>#</a></h2><p>IDaaSの機能を誤って利用することにより、ユーザーに紐づくカスタム属性などの変更が可能になり、アプリケーションにおける権限昇格や意図しないアクセスを引き起こす可能性が存在します。</p><h2 id=原因>原因
<a class=anchor href=#%e5%8e%9f%e5%9b%a0>#</a></h2><p>権限情報に関するカスタム属性を変更する機能のアクセス制御が適切に行われていないことから、第三者が属性を変更し権限を書き換える可能性が存在します。本稿ではAmazon Cognitoの誤った利用を例に原因について解説します。</p><p><strong>誤った利用の例 1. 権限に関する属性が変更可能</strong></p><p>ユーザーに対してアプリケーションの権限に関する属性の変更権限を与えることにより、属性を任意の値に変更される恐れがあります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ACCESS_TOKEN<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;eJy...&#34;</span> <span style=color:#75715e># JWT形式のアクセストークン</span>
</span></span><span style=display:flex><span>$ aws cognito-idp update-user-attributes <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --user-attributes Name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;custom:role&#34;</span>,Value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;admin&#34;</span> <span style=color:#ae81ff>\ </span><span style=color:#75715e># アプリケーションの権限に関わるカスタム属性の変更</span>
</span></span><span style=display:flex><span>  --access-token $ACCESS_TOKEN
</span></span></code></pre></div><p><strong>誤った利用の例 2. 公開されたクライアントIDによるアクセス制御</strong></p><p>一部IDaaSでは、自らの情報へアクセスを行う際にクライアントIDのような特定の識別子を用いてアクセスを行います。このクライアントIDはユーザの属性に関する変更や閲覧に関する操作を司っており、OIDCにおけるScopeのような動作をします。</p><p>このクライアントIDを用いてユーザの属性変更に関するアクセス制御をしており、かつ取得に制限のかけられていないJavaSctriptファイルやapkファイルなどにこの管理者用のクライアントIDが含まれている場合、攻撃者はこのクライアントIDを用いてTokenを発行し、自らの権限に関わる属性を変更しアプリケーション内の権限を昇格させることが可能です。</p><h2 id=影響>影響
<a class=anchor href=#%e5%bd%b1%e9%9f%bf>#</a></h2><p>本来であれば閲覧を想定していない第三者が、該当の画面やエンドポイントへアクセスできる可能性があります。</p><h2 id=対策>対策
<a class=anchor href=#%e5%af%be%e7%ad%96>#</a></h2><h3 id=根本的対策>根本的対策
<a class=anchor href=#%e6%a0%b9%e6%9c%ac%e7%9a%84%e5%af%be%e7%ad%96>#</a></h3><p>根本的対策として、一般ユーザーから権限に関わるカスタム属性の値を変更させないようにしてください。権限に関わるカスタム属性の操作を必要とする場合はRBAC等を用いて管理者権限のユーザーのみが変更できるようにしてください。</p><p>また、カスタム属性を利用しないで権限を管理する機能がある場合、その機能を用いることも検討してください。</p><h3 id=一時的対策>一時的対策
<a class=anchor href=#%e4%b8%80%e6%99%82%e7%9a%84%e5%af%be%e7%ad%96>#</a></h3><p>一時的対策として、IDaaSへのIP制限等を行い、管理者利用するIDaaSへの一般ユーザーのアクセスをNWレベルで制限してください。</p><p>また、本対策を恒久的な対策とせず、根本的な対策を実施してください。</p><h3 id=具体-amazon-cognito-user-pool>具体: Amazon Cognito User Pool
<a class=anchor href=#%e5%85%b7%e4%bd%93-amazon-cognito-user-pool>#</a></h3><p>Amazon Cognito User Poolにおいては、ユーザーの属性で権限情報を管理可能ですが、Cognito User Poolの管理者APIに対してRBACを実装する場合、このユーザグループを用いて管理することも検討してください。</p><h2 id=学習方法参考文献>学習方法/参考文献
<a class=anchor href=#%e5%ad%a6%e7%bf%92%e6%96%b9%e6%b3%95%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae>#</a></h2><ul><li><a href=https://docs.aws.amazon.com/ja_jp/cognito/latest/developerguide/user-pool-settings-attributes.html>Amazon Web Service - Amazon Cognito - ユーザープール属性</a></li><li><a href=https://docs.aws.amazon.com/ja_jp/cognito/latest/developerguide/cognito-user-pools-user-groups.html>Amazon Web Service - Amazon Cognito - ユーザーグループ</a></li><li><a href=https://blog.flatt.tech/entry/cloud_security_aws_case#341-Cognito-User-Pool>Flatt Security inc. - AWS 診断を事例としたクラウドセキュリティ。サーバーレス環境の不備や見落としがちな Cognito の穴による危険性</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/WebAppPentestGuidelines/newtechtestdoc/commit/d95c8463206e5533a49fc05b90cb19274d70b603 title='最終更新者 kazu1130 | March 24, 2023' target=_blank rel=noopener><img src=/newtechtestdoc/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 24, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#概要>概要</a></li><li><a href=#原因>原因</a></li><li><a href=#影響>影響</a></li><li><a href=#対策>対策</a><ul><li><a href=#根本的対策>根本的対策</a></li><li><a href=#一時的対策>一時的対策</a></li><li><a href=#具体-amazon-cognito-user-pool>具体: Amazon Cognito User Pool</a></li></ul></li><li><a href=#学習方法参考文献>学習方法/参考文献</a></li></ul></nav></div></aside></main></body></html>